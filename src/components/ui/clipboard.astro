---
import type { HTMLAttributes } from 'astro/types';
import { Check, Clipboard as ClipboardIcon } from 'lucide-astro';
import { twMerge } from 'tailwind-merge';

type Props = HTMLAttributes<'button'> & { content?: string; target?: string };

const { class: className, 'aria-label': ariaLabel, content, target, ...props } = Astro.props;
---

<button
  {...props}
  x-data="{ copied: false }"
  aria-label={ariaLabel ?? 'Copy to clipboard'}
  @click={`navigator.clipboard.writeText(${target} ? ${target}?.textContent?.trim() : "${content}").then(() => copied = true)`}
  @mouseleave.debounce.1000ms="copied && (copied = false)"
  class={twMerge(
    'group flex select-none items-center gap-2 rounded hover:text-emphasis',
    'focus-visible:outline-none focus-visible:ring-2 motion-safe:transition-colors',
    className,
  )}
>
  <slot />
  <ClipboardIcon size={14} aria-hidden x-show="!copied" />
  <Check size={14} aria-hidden x-show="copied" />
</button>
